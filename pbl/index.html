<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Smart Room App</title>
    <link rel="manifest" href="manifest.json">
    <link rel="stylesheet" href="src/css/styles.css">
    <meta name="theme-color" content="#28a745">
    <!-- Apple Touch Icon (iOS) -->
    <link rel="apple-touch-icon" href="assets/icons/icon-180x180.png">
    <!-- Favicons -->
    <link rel="icon" type="image/png" sizes="192x192" href="assets/icons/icon-192x192.png">
    <link rel="icon" type="image/png" sizes="32x32" href="assets/icons/icon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="assets/icons/icon-16x16.png">
    <!-- Material Icons -->
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons+Round" rel="stylesheet">
</head>
<body>
    <!-- Auth Container (Login) -->
    <div id="auth-container" class="auth-container">
        <div class="auth-card">
            <h1>Welcome</h1>
            <p>Sign in to control Smart Room</p>
            
            <button id="btn-google-login" class="btn-google">
                <img src="https://www.gstatic.com/firebasejs/ui/2.0.0/images/auth/google.svg" alt="G">
                Sign in with Google
            </button>
            <!-- Apple Login (Requires Paid Developer Account) 
            <button id="btn-apple-login" class="btn-apple">
                <img src="https://www.gstatic.com/firebasejs/ui/2.0.0/images/auth/apple.svg" alt="A">
                Sign in with Apple
            </button>
            -->

            <div class="divider"><span>OR</span></div>

            <form id="email-login-form">
                <div class="form-group">
                    <input type="email" id="login-email" placeholder="Email" required>
                </div>
                <div class="form-group">
                    <input type="password" id="login-pass" placeholder="Password" required>
                </div>
                <button type="submit" class="btn-login">Login</button>
            </form>
            <p class="auth-footer">Don't have an account? <a href="#" id="link-signup">Sign Up</a></p>
        </div>
    </div>

    <!-- Sign Up Container -->
    <div id="signup-container" class="auth-container hidden">
        <div class="auth-card">
            <h1>Create Account</h1>
            <form id="signup-form">
                <div class="form-group">
                    <input type="email" id="signup-email" placeholder="Email" required>
                </div>
                <div class="form-group">
                    <input type="password" id="signup-pass" placeholder="Password (min 6 chars)" required>
                </div>
                <button type="submit" class="btn-login">Sign Up</button>
            </form>
            <p class="auth-footer">Already have an account? <a href="#" id="link-login">Login</a></p>
        </div>
    </div>

    <!-- Pending Approval Container -->
    <div id="pending-container" class="auth-container hidden">
        <div class="auth-card">
            <h1>‚è≥ Pending Approval</h1>
            <p>Your account is waiting for administrator approval.</p>
            <p class="user-email-display" id="pending-email"></p>
            <button id="btn-logout-pending" class="btn-secondary">Logout</button>
        </div>
    </div>

    <!-- Main App Container (Hidden by default) -->
    <div class="app-container hidden" id="main-app">
        <header>
            <div>
                <h1>Smart Room</h1>
                <div class="connection-status" id="connection-status">Connecting...</div>
            </div>
            <div class="header-controls">
                <button class="settings-btn" id="btn-settings-menu" title="Menu">
                    <span class="material-icons-round">menu</span>
                </button>
                <div class="dropdown-menu hidden" id="dropdown-menu">
                    <button id="btn-theme-toggle">
                        <span class="material-icons-round">dark_mode</span>
                        <span>Dark Mode</span>
                    </button>
                    <button id="btn-admin" class="hidden">
                        <span class="material-icons-round">admin_panel_settings</span>
                        <span>Admin Panel</span>
                    </button>
                    <button id="btn-wifi-settings">
                        <span class="material-icons-round">wifi</span>
                        <span>WiFi Config</span>
                    </button>
                    <div class="dropdown-divider"></div>
                    <button id="btn-logout" class="logout-item">
                        <span class="material-icons-round">logout</span>
                        <span>Logout</span>
                    </button>
                </div>
            </div>
        </header>
        
        <!-- Office Time Indicator -->
        <div class="office-indicator home-time" id="office-indicator">
            <span class="material-icons-round">home</span>
            <span>Home Time</span>
        </div>

        <main>
            <!-- Light 1 -->
            <div class="card">
                <div class="card-header">
                    <span class="material-icons-round icon">lightbulb</span>
                    <span class="label">Light 1</span>
                    <span class="status-badge" id="status-light1">OFF</span>
                </div>
                <div class="card-body">
                    <label class="toggle-switch">
                        <input type="checkbox" id="light1">
                        <span class="slider"></span>
                    </label>
                </div>
            </div>

            <!-- Light 2 -->
            <div class="card">
                <div class="card-header">
                    <span class="material-icons-round icon">lightbulb</span>
                    <span class="label">Light 2</span>
                    <span class="status-badge" id="status-light2">OFF</span>
                </div>
                <div class="card-body">
                    <label class="toggle-switch">
                        <input type="checkbox" id="light2">
                        <span class="slider"></span>
                    </label>
                </div>
            </div>

            <!-- AC -->
            <div class="card">
                <div class="card-header">
                    <span class="material-icons-round icon">ac_unit</span>
                    <span class="label">Air Conditioner</span>
                    <span class="status-badge" id="status-ac">OFF</span>
                </div>
                <div class="card-body">
                    <label class="toggle-switch">
                        <input type="checkbox" id="ac">
                        <span class="slider"></span>
                    </label>
                </div>
            </div>

            <!-- Fan -->
            <div class="card fan-card">
                <div class="card-header">
                    <span class="material-icons-round icon">mode_fan</span>
                    <span class="label">Fan Control</span>
                    <span class="value" id="fan-value">OFF</span>
                </div>
                <div class="card-body">
                    <input type="range" min="0" max="3" value="0" step="1" id="fan" class="range-slider">
                    <div class="range-labels">
                        <span>OFF</span>
                        <span>1</span>
                        <span>2</span>
                        <span>3</span>
                    </div>
                </div>
            </div>

            <!-- Master Control -->
            <button class="btn-all-off" id="btn-all-off">Turn All OFF</button>
        </main>

        <footer>
            <p>PBL IT Department</p>
        </footer>

    </div>

    <!-- Settings Modal -->
    <div id="settings-modal" class="modal">
        <div class="modal-content">
            <span class="close-btn" id="close-settings"><span class="material-icons-round">close</span></span>
            <h2><span class="material-icons-round">settings</span> System Config</h2>
            
            <div class="form-group">
                <label>WiFi SSID (Router Name)</label>
                <input type="text" id="wifi-ssid" placeholder="Enter WiFi Name">
            </div>
            <div class="form-group">
                <label>WiFi Password</label>
                <input type="password" id="wifi-pass" placeholder="Enter WiFi Password">
            </div>
            
            <button class="btn-save" id="btn-update-wifi">Save & Update WiFi</button>
            <p style="font-size: 0.8rem; color: #666; margin-top: 10px;">
                Note: Device will restart after update. Ensure you enter correct details.
            </p>
        </div>
    </div>

    <!-- Admin Modal -->
    <div id="admin-modal" class="modal">
        <div class="modal-content">
            <span class="close-btn" id="close-admin"><span class="material-icons-round">close</span></span>
            <h2><span class="material-icons-round">admin_panel_settings</span> User Management</h2>
            <div id="user-list" class="user-list">
                <!-- User items will be injected here -->
                <div class="loader">Loading users...</div>
            </div>
        </div>
    </div>

    <!-- Firebase SDKs -->

    <!-- Firebase SDKs -->
    <script type="module" src="src/js/app.js"></script>
    <script>
        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.register('sw.js')
                .then(reg => console.log('Service Worker Registered'))
                .catch(err => console.log('Service Worker Error', err));
        }
    </script>
</body>
</html>